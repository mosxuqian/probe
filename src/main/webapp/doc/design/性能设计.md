# 性能设计

## 概述

### 前言

系统的性能主要指系统的运行速度和稳定性。功能再强大，而性能很差、频繁宕机，系统便失去了可用性，性能好的软件系统能获得更好的用户体验，从而给用户留下高质量软件的良好印象。

在架构设计初期就一定要把系统性能考虑在内。否则等开发完成以后测试发现性能不好就比较难办，通常要花费较长的时间来诊断性能瓶颈，找到提升的办法，甚至要改变架构，伤筋动骨，导致项目延期。所以性能设计首先要有明确的性能目标，根据用户和软件本身的性能要求来设计，合适的就是最好的。其次，要有适当的度量标准和量化的性能指标。最后，要有相应的设计策略、应对方案和具体的测试方法。因此，在进行架构设计中性能设计非常重要。

### 一些性能指标的概念

- 响应时间：指系统对请求作出响应的时间。包括某个功能或所有功能的平均时间、最大响应时间。
- 吞吐量：指系统在单位时间内处理请求的数量。对于无并发的应用系统而言，吞吐量与响应时间成严格的反比关系。对于单用户的系统，响应时间可以很好地度量系统的性能，但对于并发系统，通常需要用吞吐量作为性能指标。
- 并发用户数：并发用户数是指系统可以同时承载的正常使用系统功能的用户的数量。与吞吐量相比，并发用户数是一个更直观、更笼统、不够准确的性能指标。相比而言，以在线用户作为性能指标更直观些，而以同时发请求用户数作为性能指标更准确些。
- QPS：即每秒查询率（Query Per Second）。对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。

### 公司的简要性能目标

> 开发过程中应引入加压开发，数据库中须模拟 3 年业务的数据量。调试功能时应保障基本执行效率，除统计分析类页面外，页面操作的响应时间应在 3s 以内；统计分析类页面操作的响应时间不得超过5s。—— 2017版技术标准之4.6.10章节。

## 影响性能的主要因素

影响系统性能主要瓶颈在**I/O**，包括**数据库**，**socket**，**网络通信**，**文件**等，例如频繁查询数据库并返回大量结果集，频繁操作大文件等，这些昂贵的操作会占用大量的CPU时间。所以性能设计时一定要考虑到I/O，同步，并发，资源争用，以及大数据量等因素。

> 通常，I/O操作、网络响应、差的数据结构和算法、数据库、以及其他的低效的资源使用都会导致低劣的性能。

以下将对影响性能的主要因素做更细致的说明。
