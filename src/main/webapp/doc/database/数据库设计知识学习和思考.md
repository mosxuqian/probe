# 数据库设计知识学习和思考

## 一、基本设计概念和理论

> 数据库设计：是指对于一个给定的应用环境，构造最优的数据模型，然后据此建立数据库及其应用系统，使之能够有效地存储数据，满足各种用户的应用需求。 

### （一）、关系型数据库

所谓的关系型数据库指的是：采用了关系模型来组织数据的数据库。简单讲，关系模型就是二维表格模型。二维表格中的行在数据库中我们称之为记录，列在数据库中我们成为字段。常见的数据库有：Oracle、Mysql、SQL Server、PostgreSQL等。

#### 1. 设计步骤

- 需求分析
- 概念结构设计
- 逻辑结构设计
- 物理结构设计
- 数据库实施
- 数据库运行和维护

#### 2. 华宇的数据库设计步骤

- 参数设置
 - 基本参数设置--字符集、页大小，以及master、tempdb库文件的大小等
 - 性能参数设置--推荐连接数、推荐内存等
- 数据库详细设计
 - 数据库结构设计--表空间、角色用户权限、Database的划分等
 - 表结构设计--各表结构的详细设计使用SMD或Power Designer
 - 索引设计--基础索引、外键索引的设计
 - 初始化数据--各种需要初始化的数据

#### 3. 数据库设计三范式

##### (1). 第一范式(1NF)

如果关系模式R的每个关系r的属性都是不可分的数据项，那么就称R是第一范式的模式。简单的说，每一个属性都是原子项，不可分割。

##### (2). 第二范式（2NF）

如果关系模式R是1NF，且每个非主属性完全函数依赖于候选键，那么就称R是第二范式。简单的说，第二范式要满足以下的条件：首先要满足第一范式，其次每个非主属性要完全函数依赖于主键。

##### (1). 第三范式（3NF）

如果关系模式R是2NF，且关系模式R（U，F）中的所有非主属性对任何候选关键字都不存在传递依赖，则称关系R是属于第三范式。简单的说，第三范式要满足以下的条件：首先要满足第二范式，其次非主属性之间不存在函数依赖。由于满足了第二范式，表示每个非主属性都函数依赖于主键。确保数据表中的每一列数据都和主键直接相关，而不能间接相关。方便理解，可以看做是“消除冗余”。

以上就是数据库设计的三范式，当然还有BC范式、第四范式和第五范式等。所谓的范式，是用来学习参考的，未必一定要全部遵守，数据库设计的时候要根据实际的业务需求、开发难易和性能等情况而做出反范式的设计。

#### 4. 关系型数据库的优缺点

##### (1). 优点

- 擅长小数据量的处理
- 擅长复杂的SQL操作,可以进行Join等复杂查询
- 可以方便的生成各种数据对象，利用存储的数据建立窗体和报表，可视性好

##### (2). 缺点

- 很难进行分布式应用和大量数据的写入处理
- 为有数据更新的表做索引和结构变更
- 字段不固定的应用
- 对简单查询需要快速返回结果的处理
 
### （二）、非关系型数据库（NoSQL）

#### 1. NoSQL数据库的概念

NoSQL，泛指非关系型的数据库。随着互联网网站和移动互联网的兴起，传统的关系数据库在应付大规模和高并发的情况下已经显得力不从心，暴露了很多难以克服的问题，而非关系型的数据库则由于其本身的特点得到了非常迅速的发展。NoSQL数据库的产生就是为了解决大规模数据集合多重数据种类带来的挑战，尤其是大数据应用难题。

NoSQL(NoSQL = Not Only SQL )，意即“不仅仅是SQL”，是一项全新的数据库革命性运动，NoSQL的拥护者们提倡运用非关系型的数据存储，相对于铺天盖地的关系型数据库运用，这一概念无疑是一种全新的思维的注入。

#### 2.NoSQL数据库四大分类

##### (1). 键值(Key-Value)存储数据库
 
主要会使用到一个哈希表，这个表中有一个特定的键和一个指针指向特定的数据。Key/value模型对于IT系统来说的优势在于简单、易部署。但是如果DBA只对部分值进行查询或更新的时候，Key/value就显得效率低下了。

- 举例如：Redis, Voldemort。
- 应用场景：内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等。
- 优点：查找速度快
- 缺点：数据无结构化，通常只被当作字符串或者二进制数据

##### (2). 列存储数据库。
 
通常是用来应对分布式存储的海量数据。键仍然存在，但是它们的特点是指向了多个列。这些列是由列家族来安排的。

- 如：Cassandra, HBase, Riak
- 应用场景：分布式的文件系统
- 优点：查找速度快，可扩展性强，更容易进行分布式扩展
- 缺点：功能相对局限

##### (3). 文档型数据库
 
该类型的数据模型是版本化的文档，半结构化的文档以特定的格式存储，比如JSON。文档型数据库可以看作是键值数据库的升级版，允许之间嵌套键值。而且文档型数据库比键值数据库的查询效率更高。

- 如：CouchDB, MongoDb
- 应用场景：Web应用（与Key-Value类似，Value是结构化的，不同的是数据库能够了解Value的内容）
- 优点：数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构
- 缺点：查询性能不高，而且缺乏统一的查询语法。

##### (4). 图形(Graph)数据库
 
图形结构的数据库同其他行列以及刚性结构的SQL数据库不同，它是使用灵活的图形模型，并且能够扩展到多个服务器上。NoSQL数据库没有标准的查询语言(SQL)，因此进行数据库查询需要制定数据模型。许多NoSQL数据库都有REST式的数据接口或者查询API。

- 如：Neo4J, InfoGrid, Infinite Graph
- 应用场景：社交网络，推荐系统等。专注于构建关系图谱
- 优点：利用图结构相关算法。比如最短路径寻址，N度关系查找等
- 缺点：很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方案。

#### 3. NoSQL数据库的优缺点

##### (1). 优点

- 擅长大量数据的写入和读取
- 快速的查询响应,灵活的数据模型
- 数据结构变更或更新非常方便，不需要更改已有数据的数据结构
- 击碎了性能瓶颈，可以使执行速度变的更快

##### (2). 缺点

- 不提供复杂的API接口
- 一般仅提供key索引
- 不适合小数据的处理