# 微服务交流

## 微服务由来

最期的单体架构带来的问题:

- 复杂性逐渐变高
- 技术债务逐渐上升
- 部署速度逐渐变慢
- 阻碍技术创新

## 什么是微服务

微服务的概念源于2014年3月Martin Fowler所写的一篇文章[Microservices](http://martinfowler.com/articles/microservices.html)。其中对“微服务”这种架构风格做了描述性的定义。微服务主要有这些特点：

- ⼀种架构风格，将单体应用划分成⼀组⼩的服务，服务之间相互协作，实现业务功能。
- 每个服务运行在独⽴的进程中，服务间采用轻量级的通信机制来协作(通常是HTTP API)。
- 每个服务围绕业务能⼒进⾏构建，并且能够通过⾃动化机制独立地部署。
- 很少有集中式的服务管理，每个服务都可以使用不同的语言开发，使⽤不同的存储技术。

## 微服务的利弊

### 利

- 每个服务都很简单，只关注于一块儿业务功能，独立扩展，松耦合，很容易理解、开发和维护
- 每个服务都可以由不同的团队独立开发
- 每个微服务可独立部署和做高可用
- 每个可以通过不同的编程语言与工具进行开发

### 弊

- 微服务应用是分布式系统，会带来固有的复杂性
- 事务性难以保证，分布式事务更多的是通过**最终一致性**来达到事务，且建议**尽量避免分布式事务**。
- 部署运维的复杂、成本高，一个功能涉及多个服务，多个服务均需要部署，每个服务都要占据进程和内存
- 测试复杂性，服务集成测试时需要启动和它有关的所有服务，单元测试时至少需要这些服务的stubs

Simon Brown的告诫：

> 如果你无法在单进程的独立应用上实现构建，那你如何确信在引入网络通信后问题可以得到解决？

如果你搞不定⼀个单体应用，别指望微服务能够拯救你!

## 康威定律

Melvin Conway于20世纪60年代后期确定了的*Conway定律*(Conway法则)。

> **康威定律**: 设计系统的组织，其产生的架构设计等价于组织之内、组织之间的沟通结构。

用通俗的说法就是：**组织形式等同系统设计**。

- 对于复杂的系统，聊设计就离不开聊人与人的沟通，解决好人与人的沟通问题，才能有一个好的系统设计。
- 沟通的问题，会带来系统设计的问题，进而影响整个系统的开发效率和最终产品结果。
- 架构也会影响到团队的协作的好坏。

## 微服务的适用性

你现在面对的系统，微服务架构是一个好的选择吗？

**微服务架构是否是一个好的选择，实际上要看系统的复杂度来决定的**。对于这个问题，Martin Fowler 在一篇名为[MicroservicePremium](https://martinfowler.com/bliki/MicroservicePremium.html)的文章里深刻阐述了这一点。他给出了一个很关键的图：

![复杂度和生产力图](http://static.blinkfox.com/wfwsyx.png)

图直观的说明了单体架构和微服务架构在不同系统复杂度下时不同的生产力，以及两者的对比关系。这篇文章谈到的很多具体内容，还需要读者自己去“阅读原文”。

综上，**对于那种需要快速为商业模式提供验证的系统，其功能较少、用户很低的情况下，单体架构是更好的选择。不过，为了考虑未来的发展，一些基础性的平台和功能还是可以单独抽离封装为微服务的。且在单体架构内部，也需要更清晰的划分功能模块（尽量不让它们产生太强的耦合），数据库设计也可预先考虑未来微服务抽离的情况**。